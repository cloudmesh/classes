




<!DOCTYPE html>



<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->



<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />

	<title>HPC | Big Data Classes</title>
	
	
	
	<meta property="og:title" content="HPC | Big Data Classes" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="/lesson/tech/hpc.html" />
	<meta property="og:image" content="/_static/path/to/your/opengraph-image.jpg" />
	
	
	<meta property="og:description" content="This is an example of the Foundation Sphinx Theme output." />
	<meta property="og:site_name" content="Big Data Classes" />
	
	
	    	<meta property="og:foo" content="bar" />
	
    
    
	<meta name="description" content="This is an example of the Foundation Sphinx Theme output.">
    
	    	<meta name="foo" content="bar" />
	
	
	
	
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../_static/foundation/css/basic.css" type="text/css" />
    	
	<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    	<script type="text/javascript" src="../../_static/jquery.js"></script>
    	<script type="text/javascript" src="../../_static/underscore.js"></script>
    	<script type="text/javascript" src="../../_static/doctools.js"></script>
    	<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    	<script type="text/javascript" src="../../_static/foundation/js/vendor/custom.modernizr.js"></script>
 
<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var s = document.createElement('script');
    var t = document.getElementsByTagName('script')[0];

    s.type = 'text/javascript';
    s.async = true;
    s.src = '//api.flattr.com/js/0.6/load.js?mode=auto';

    t.parentNode.insertBefore(s, t);
 })();
/* ]]> */
</script>

</head>



<body>
	<div id="root"><div class="contain-to-grid">
			<nav class="top-bar">
				<ul class="title-area">
					<li class="name">
					  <h1><a href="../../index.html">Big Data Classes</a></h1>
					</li>
					<li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
				</ul>
				 
				<section class="top-bar-section">
					<ul class="left"><li class="divider"></li></ul>
					
						<ul>
							<li class="has-dropdown">
								<a href="">Sections</a>
								<ul class="dropdown ">
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i524/index.html">I524 Big Data &amp; Open Source Software Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i523/index.html">I523 Big Data Applications and Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Lessons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/index.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">Todos</a></li>
</ul>

							</li>
						</ul>
					
					<ul class="left">
						
	<li class="divider"></li>

	
		
			<li><a href="../../genindex.html"  title="General Index">index</a></li>
		

	
					</ul>
				</section>
			</nav>
		</div><div id="header">
			<div class="row">
				
		        <div id="logo-container" class="large-6 columns">
		        	
	<div>
		<a href="../../index.html">
		
	    	<h1 id="logo">Big Data Classes</h1>
		
		</a>
	</div>

		        </div>
		        <div class="large-6 columns">
		            <p id="motto">
						This page is under construction and will change. Content will go live Jan. 9, 2017
					</p>
		        </div>
		        
		    </div>
	    </div>
	    
	    <div class="social-buttons">
	    	
	    </div>
		
		
		
		<div class="row">
	</div>
		
		
		<div class="row">
			
			<div id="content" class="large-9 push-3 columns">
				
  <div class="section" id="hpc">
<span id="s-hpc"></span><h1>HPC<a class="headerlink" href="#hpc" title="Permalink to this headline">¶</a></h1>
<div class="section" id="login-nodes">
<span id="s-hpc-access"></span><h2>Login Nodes<a class="headerlink" href="#login-nodes" title="Permalink to this headline">¶</a></h2>
<p>Several of the clusters have High Performance Computing (HPC) services
installed. Access to them is provided via a Linux Login node for each
of the clusters on which these services are installed.</p>
<p>To access the login nodes you need a FG resource account and an SSH
public key you have uploaded to FutureGrid (this process is described
in the section about <span class="xref std std-ref">s-accounts</span>. After you are part of a valid
project and have a FutureGrid account, you can log into the FutureGrid
resources with ssh. Multiple systems are accessed through the follong
node:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>india.futuregrid.org
</pre></div>
</div>
<p>The systems include india, bravo, delta, echo</p>
<p>To log into xray, please use:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>xray.futuregrid.org
</pre></div>
</div>
<p>For example, assume your portalname is &#8220;portalname&#8221;, than you can
login to sierra as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ssh portalname@india.futuregrid.org
Welcome to india.futuregrid.org
Last login: Thu Aug <span class="m">12</span> 19:19:22 <span class="m">2010</span> from ....
</pre></div>
</div>
<div class="section" id="ssh-add">
<span id="s-sshadd"></span><h3>SSH Add<a class="headerlink" href="#ssh-add" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may wish to log in repeatedly in other machines while
using a cached password. To do that you can use ssh agent and ssh
add. First start the agent:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">eval</span> <span class="sb">`</span>ssh-agent<span class="sb">`</span>
</pre></div>
</div>
<p>Then add your key with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ssh-add
</pre></div>
</div>
<p>Follow the instructions on the screen. Thus before you ssh in, you may
want to use ssh agent. This way you do not have to repeatedly type in
your key password.</p>
</div>
<div class="section" id="ssh-config">
<h3>SSH Config<a class="headerlink" href="#ssh-config" title="Permalink to this headline">¶</a></h3>
<p>Also you may want to setup your ~/.ssh/config file to create shortcut
for the username and hosts on which you want to log in. Let us assume
your username is albert, then add the following lines in the .ssh/config
file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Host india
      Hostname india.futuregrid.org
      User albert
</pre></div>
</div>
<p>This will allow you to log into the machine just while typing in:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ssh india
</pre></div>
</div>
</div>
<div class="section" id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h3>
<p>The login nodes have the <a class="reference external" href="http://modules.sourceforge.net">modules</a>
package installed. It provides a convenient tool to adapt your
environment and enables you to activate different packages and services
dependent on your specific needs. The Modules are utilized to let you
dynamically control your environment. Modules allows you to load and
unload packages and ensure a coherent working environment.
This ensures that your $PATH, $LD_LIBRARY_PATH, $LD_PRELOAD, and other
environment variables are properly set, and that you can access the
programs and libraries you need. For additional information about the
Modules package you can consult the <a class="reference external" href="http://modules.sourceforge.net/man/module.html">manual page</a>.</p>
<p>To display the list of available modules:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module avail
</pre></div>
</div>
<p>To display the list of currently loaded modules:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module list
</pre></div>
</div>
<p>To add and remove packages from your environment you can use the
<em>module load</em> and <em>module unload</em> commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module load &lt;package name&gt;/&lt;optional package version&gt;
$ module unload &lt;package name&gt;/&lt;optional package version&gt;
</pre></div>
</div>
<p>The available command are listed in the next table:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Module commands</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Command</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>module avail</td>
<td>List all software packages available on the system.</td>
</tr>
<tr class="row-odd"><td>module avail package</td>
<td>List all versions of package available on the system</td>
</tr>
<tr class="row-even"><td>module list</td>
<td>List all packages currently loaded in your environment.</td>
</tr>
<tr class="row-odd"><td>module load package/version</td>
<td>Add the specified version of the package to your environment</td>
</tr>
<tr class="row-even"><td>module unload package</td>
<td>Remove the specified package from your environment.</td>
</tr>
<tr class="row-odd"><td>module swap package_A package_B</td>
<td>Swap the loaded package (package_A) with another package (package_B).</td>
</tr>
<tr class="row-even"><td>module show package</td>
<td>Shows what changes will be made to your environment (e.g. paths to libraries and executables) by loading the specified package.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong> - List the currently loaded modules on india after login:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module list

Currently Loaded Modulefiles:
  1<span class="o">)</span> torque/2.4.8   2<span class="o">)</span> moab/5.4.0
</pre></div>
</div>
<p><strong>Example</strong> - list the avialable modules on india:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module avail

----------------- /opt/Modules/3.2.8/modulefiles/applications ------------------
R/2.11.1<span class="o">(</span>default<span class="o">)</span>      hpcc/1.3.1<span class="o">(</span>default<span class="o">)</span>    velvet/1.0.15
git/1.7.10             ncbi/2.2.23<span class="o">(</span>default<span class="o">)</span>   wgs/6.1
gromacs/4.0.7<span class="o">(</span>default<span class="o">)</span> soapdenovo/1.04

------------------- /opt/Modules/3.2.8/modulefiles/compilers -------------------
cmake/2.8.1<span class="o">(</span>default<span class="o">)</span>       java/1.6.0-i586
intel/10.1                 java/1.6.0-x86_64<span class="o">(</span>default<span class="o">)</span>
intel/11.1<span class="o">(</span>default<span class="o">)</span>

------------------- /opt/Modules/3.2.8/modulefiles/debuggers -------------------
null                       totalview/8.8.0-2<span class="o">(</span>default<span class="o">)</span>

------------------- /opt/Modules/3.2.8/modulefiles/libraries -------------------
intelmpi/4.0.0.028<span class="o">(</span>default<span class="o">)</span>  openmpi/1.4.3-intel
mkl/10.2.5.035<span class="o">(</span>default<span class="o">)</span>      otf/1.7.0<span class="o">(</span>default<span class="o">)</span>
openmpi/1.4.2<span class="o">(</span>default<span class="o">)</span>       unimci/1.0.1<span class="o">(</span>default<span class="o">)</span>
openmpi/1.4.3-gnu            vampirtrace/intel-11.1/5.8.2

--------------------- /opt/Modules/3.2.8/modulefiles/tools ---------------------
cinderclient/1.0.4<span class="o">(</span>default<span class="o">)</span>   moab/5.4.0<span class="o">(</span>default<span class="o">)</span>
cloudmesh/0.8<span class="o">(</span>default<span class="o">)</span>        myhadoop/0.2a
euca2ools/1.2                 novaclient/2.13.0<span class="o">(</span>default<span class="o">)</span>
euca2ools/1.3.1               precip/0.1<span class="o">(</span>default<span class="o">)</span>
euca2ools/2.0.2<span class="o">(</span>default<span class="o">)</span>      python/2.7<span class="o">(</span>default<span class="o">)</span>
genesisII/2.7.0               python/2.7.2
glanceclient/0.9.0<span class="o">(</span>default<span class="o">)</span>   torque/2.4.8<span class="o">(</span>default<span class="o">)</span>
keystoneclient/0.2.3<span class="o">(</span>default<span class="o">)</span> vim/7.2
marmot/2.4.0<span class="o">(</span>default<span class="o">)</span>
</pre></div>
</div>
<p><strong>Example</strong> - load the default version of a module (in this case git):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module load git
</pre></div>
</div>
<p>Please note that for loading the default you do not have to specify the version number.</p>
</div>
<div class="section" id="filesystem-layout">
<h3>Filesystem Layout<a class="headerlink" href="#filesystem-layout" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><em>Home</em> directories:</dt>
<dd>Home directories are accessible through the $HOME shell variable which are
located at <em>/N/u/&lt;username&gt;</em>. This is where users are encouraged to
keep source files, configuration files and executables. Users
should not run code from their $HOME directories. Please note that
this is an NFS file system, and may result in slower access for
some applications. We also advise the users to provide external
backup storage at their home institution or a code repository. For
example, we recommend that you use git or svn to make sure you
backup your changes to the code. Also make sure you backup your
data. As a testbed, we do not guarantee data loss.</dd>
<dt><em>Scratch</em> directories:</dt>
<dd>Scratch directories are located at different locations on the
systems. To find out more about the file layout, please see the
section <span class="xref std std-ref">s-storage</span></dd>
<dt><em>System software</em> directories:</dt>
<dd>System software directories are located at <em>/N/soft</em>. System and
community software are typically installed here. Table
<span class="xref std std-ref">t-storage-mountpoint</span> provides a summary of the various mount
points.</dd>
</dl>
</div>
</div>
<div class="section" id="message-passing-interface-mpi">
<h2>Message Passing Interface (MPI)<a class="headerlink" href="#message-passing-interface-mpi" title="Permalink to this headline">¶</a></h2>
<p>The <em>Message Passing Interface Standard (MPI)</em> is the <em>de facto</em>
standard communication library for almost many HPC systems, and is
available in a variety of implementations. It has been created through
consensus of the MPI Forum, which has dozens of participating
organizations, including vendors, researchers, software library
developers, and users. The goal of the Message Passing Interface is to
provide a portable, efficient, and flexible standard for programs
using message passing. For more information about MPI, please visit:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.mpi-forum.org/">http://www.mpi-forum.org/</a></li>
<li><a class="reference external" href="http://www.mcs.anl.gov/research/projects/mpi/tutorial/">http://www.mcs.anl.gov/research/projects/mpi/tutorial/</a></li>
<li><a class="reference external" href="http://www.open-mpi.org/">http://www.open-mpi.org/</a></li>
</ul>
<div class="section" id="mpi-libraries">
<h3>MPI Libraries<a class="headerlink" href="#mpi-libraries" title="Permalink to this headline">¶</a></h3>
<p>Several FutureGrid systems support MPI as part of their HPC services.
An up to date status about it can be retrieved via our <a class="reference external" href="http://inca.futuregrid.org:8080/inca/jsp/status.jsp?suiteNames=HPC,HPC_Tests,Benchmarks&amp;resourceIds=FG_BATCH">Inca
status pages</a>.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text">MPI versions installed on FutureGrid HPC services</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">System</th>
<th class="head">MPI version</th>
<th class="head">Compiler</th>
<th class="head">Infiniband Support</th>
<th class="head">Module</th>
<th class="head">&nbsp;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Bravo</td>
<td>OpenMPI 1.4.2</td>
<td>Intel 11.1</td>
<td>no</td>
<td>openmpi</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>OpenMPI 1.4.3</td>
<td>gcc 4.4.6</td>
<td>no</td>
<td>openmpi/1.4.3-gnu</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>OpenMPI 1.4.3</td>
<td>Intel 11.1</td>
<td>no</td>
<td>openmpi/1.4.3-intel</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>OpenMPI 1.5.4</td>
<td>gcc 4.4.6</td>
<td>no</td>
<td>openmpi/1.5.4-[gnu</td>
<td>intel]</td>
</tr>
<tr class="row-even"><td>India</td>
<td>OpenMPI 1.4.2</td>
<td>Intel 11.1</td>
<td>yes</td>
<td>openmpi</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>Xray</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>N/A</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>Loading the OpenMPI module adds the MPI compilers to your $PATH
environment variable and the OpenMPI shared library directory to your
$LD_LIBRARY_PATH. This is an important step to ensure that MPI applications
will compile and run successfully. In cases where the OpenMPI is
compiled with the Intel compilers loading the OpenMPI module will
automatically load the Intel compilers as a dependency. To load the
default OpenMPI module and associated compilers, just use:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module load openmpi
</pre></div>
</div>
</div>
<div class="section" id="compiling-mpi-applications">
<h3>Compiling MPI Applications<a class="headerlink" href="#compiling-mpi-applications" title="Permalink to this headline">¶</a></h3>
<p>To compile MPI applications, users can simply use the available mpi
compile commands:</p>
<dl class="docutils">
<dt>mpicc:</dt>
<dd>To compile C programs with the CC/icc/gcc compilers</dd>
<dt>mpicxx:</dt>
<dd>To compile c++ programs with CXX/icpc/g++ compilers</dd>
<dt>mpif90:</dt>
<dd>To compile programs with F90/F77/FC/ifort/gfortran</dd>
</dl>
<p>To see in detail what these commands do you can add a <em>-show</em>  as an
option. Thus the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mpicc -show
$ mpicxx -show
$ mpif90 -show
</pre></div>
</div>
<p>will show you the detail of each of them. The resulting output can be
used as a template to adapt compile flags in case the default settings are
not suitable for you.</p>
<p>Assuming you have loaded the OpenMPI module into your environment,
you can compile a <a class="reference external" href="ring.html">simple MPI application</a> easily by executing:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mpicc -o ring ring.c
</pre></div>
</div>
<p>Users MUST NOT run jobs on the login or headnodes. These nodes are
reserved for editing and compiling programs. Furthermore running your
commands on such nodes will not provide any useful information as you
actually do not use the standard cluster node.</p>
</div>
<div class="section" id="batch-jobs">
<h3>Batch Jobs<a class="headerlink" href="#batch-jobs" title="Permalink to this headline">¶</a></h3>
<p>Once your MPI application is compiled, you run it on the compute nodes
of a cluster via a batch processing. With the help of a batch
processing services a job is run on the cluster without the users
intervention via a job queue. The user does not have to worry much
about the internal details of the job queue, but must provide the
scheduler with some guidance about the job so it can be efficiently
scheduled on the system.</p>
<p>To run jobs on resources with the HPC services, users must first
activate their environment to use the job scheduler:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ module load torque
</pre></div>
</div>
<p>A complete manual for the torque scheduler can be found in the <a class="reference external" href="http://www.clusterresources.com/torquedocs21/">Torque
manual</a> .</p>
<p>Next we need to create a script so that we can run the program on the
cluster.  We will be using our simple ring example to illustrate some
of the parameters you need to adjust. Please save the following content to
a file called ring.pbs.:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>

<span class="c1"># OPTIONS FOR THE SCRIPT</span>
<span class="c1">#PBS -M username@example.com</span>
<span class="c1">#PBS -N ring_test</span>
<span class="c1">#PBS -o ring_$PBS_JOBID.out</span>
<span class="c1">#PBS -e ring_$PBS_JOBID.err</span>
<span class="c1">#PBS -q batch</span>
<span class="c1">#PBS -l nodes=4:ppn=8</span>
<span class="c1">#PBS -l walltime=00:20:00</span>


<span class="c1"># make sure MPI is in the environment</span>
module load openmpi

<span class="c1"># launch the parallel application with the correct number of process</span>
<span class="c1"># Typical usage: mpirun -np &lt;number of processes&gt; &lt;executable&gt; &lt;arguments&gt;</span>
mpirun -np <span class="m">32</span> ring -t 1000

<span class="nb">echo</span> <span class="s2">&quot;Nodes allocated to this job: &quot;</span>
cat <span class="nv">$PBS_NODEFILE</span>
</pre></div>
</td></tr></table></div>
<p>This file can be used to submit a job to the queueing system by calling the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>qsub ring.pbs
</pre></div>
</div>
<p>In the job script, lines that begin with  <strong>#PBS</strong> are directives to
the job scheduler. You can disable any of these lines by adding an
extra  <strong>#</strong> character at the beginning of the line, as <em>##</em> is
interpreted to be a comment. Common options include:</p>
<ul class="simple">
<li>-M: specify a mail address that is notified upon completion</li>
<li>-N: To specify a job name</li>
<li>-o: The name of the file to write stdout to</li>
<li>-e: The name of the file to write stderr to</li>
<li>-q: The queue to submit the job to</li>
<li>-l: Resources specifications to execute the job</li>
</ul>
<p>The first parameters are rather obvious, so let us focus on the
<em>-q</em> option. Each batch service is configured with a number of
queues that are targeting different classes of jobs to schedule them more
efficiently. These queues can be switch on or off,
be modified or new queues can be added to the system. It is useful to get
a list of available queues on the system of where you would like to submit your
jobs. You can also inspect which would be the most suitable queue to use for your
purpose with the qstat command on the appropriate login node:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ qstat -q
</pre></div>
</div>
<p>Currently we have the following queues:</p>
<dl class="docutils">
<dt>HPC Job Queue Information:</dt>
<dd><table border="1" class="first last docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Resource</th>
<th class="head">Queue name</th>
<th class="head">Default Wallclock Limit</th>
<th class="head">Max Wallclock Limit</th>
<th class="head">NOTES</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>india</td>
<td>batch</td>
<td>4 hours</td>
<td>24 hours</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>long</td>
<td>8 hours</td>
<td>168 hours</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>scalemp</td>
<td>8 hours</td>
<td>168 hours</td>
<td>restricted access</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>Next we focus on the -l option that specifies the resources. The
term:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">nodes</span><span class="o">=</span>4
</pre></div>
</div>
<p>means that we specify 4 servers on which we execute the job. The
term:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">ppn</span><span class="o">=</span>8
</pre></div>
</div>
<p>means that we use 8 virtual processors per node, where a virtual
processor is typically executed on a core of the server. Thus it is
advisable not to exceed the number of cores per server. For some
programs choosing the best performing number of servers and cores may
be dependent on factors such as memory needs, IO access and other
resource bounded properties. You may have to experiment with the
parameters. To identify the number of servers and cores available
please see Tables <span class="xref std std-ref">t-clusters</span> and <span class="xref std std-ref">t-clusters-details</span>.
For example, India has 8 cores per node,
thus 4 servers would provide you access to 32 processing units.</p>
<p>Often you may just want to have the stdout and stderr in one file,
then you simply can replace the line with -e in it with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1">#PBS -j oe</span>
</pre></div>
</div>
<p>which simply means that you <em>join</em> stdout and stderr. Here j stands
for join, o for stdout and e for stderr. In case you would like to have
an e-mail sent to you based on the status of the job, you can add:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1">#PBS -m ae</span>
</pre></div>
</div>
<p>to your script. It will send you a mail when the job aborts (indicated
by a), or when the job ends (indicated by e).</p>
</div>
</div>
<div class="section" id="job-management">
<h2>Job Management<a class="headerlink" href="#job-management" title="Permalink to this headline">¶</a></h2>
<p>A list of all available  scheduler commands is available from the <a class="reference external" href="http://www.clusterresources.com/torquedocs21/">Torque
manual page</a>. We
describe next the use of some typical interactions to manage your jobs
in the batch queue.</p>
<div class="section" id="job-submission">
<h3>Job Submission<a class="headerlink" href="#job-submission" title="Permalink to this headline">¶</a></h3>
<p>Once you have created a submission script, you can then use the
qsub command to submit this job to be executed on the compute nodes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ qsub ring.pbs
20311.i136
</pre></div>
</div>
<p>The qsub command outputs either a job identifier or an error message
describing why the scheduler would not accept your job. Alternatively,
you can also use the msub command, which is very similar to the qsub
command. For differences we ask you to consult the manual pages.</p>
</div>
<div class="section" id="job-deletion">
<h3>Job Deletion<a class="headerlink" href="#job-deletion" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you may want to delete a job from the queue, which can be
easily done with the qdel command, followed by the id:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ qdel 20311
</pre></div>
</div>
</div>
<div class="section" id="job-monitoring">
<h3>Job Monitoring<a class="headerlink" href="#job-monitoring" title="Permalink to this headline">¶</a></h3>
<p>If your job is submitted successfully, you can track its execution
using the qstat or showq commands. Both commands will show you the
state of the jobs submitted to the scheduler. The difference is mostly
in their output format.</p>
<dl class="docutils">
<dt>showq:</dt>
<dd><p class="first">Divides the output into three sections:  active
jobs,  eligible jobs, and blocked jobs:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ showq
active <span class="nb">jobs</span>
------------------------
JOBID    USERNAME       STATE PROCS    REMAINING            STARTTIME
<span class="m">20311</span>   yourusername       Running     <span class="m">16</span>        3:59:59 Tue Aug <span class="m">17</span> 09:02:40
<span class="m">1</span> active job <span class="m">16</span> of <span class="m">264</span> processors in use by <span class="nb">local</span> <span class="nb">jobs</span> <span class="o">(</span>6.06%<span class="o">)</span>
                  <span class="m">2</span> of <span class="m">33</span> nodes active <span class="o">(</span>6.06%<span class="o">)</span> eligible <span class="nb">jobs</span>
----------------------
JOBID    USERNAME       STATE PROCS    REMAINING            STARTTIME
<span class="m">0</span> eligible <span class="nb">jobs</span> blocked <span class="nb">jobs</span>
-----------------------
JOBID    USERNAME       STATE PROCS    REMAINING            STARTTIME
<span class="m">0</span> blocked <span class="nb">jobs</span>
Total job: 1
</pre></div>
</div>
<dl class="last docutils">
<dt>Legend:</dt>
<dd><dl class="first last docutils">
<dt>Active jobs:</dt>
<dd>are jobs that are currently running on resources.</dd>
<dt>Eligible jobs:</dt>
<dd>are jobs that are waiting for nodes to become available before
they can run. As a general rule, jobs are listed in the order
that they will be scheduled, but scheduling algorithms may
change the order over time.</dd>
<dt>Blocked jobs:</dt>
<dd>are jobs that the scheduler cannot run for some reason. Usually
a job becomes blocked because it is requesting something that
is impossible, such as more nodes than those which currently exist, or more
processors per node than are installed.</dd>
</dl>
</dd>
</dl>
</dd>
<dt>qstat:</dt>
<dd><p class="first">provides a single table view, where the status of each job is
added via a status column called S:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ qstat
Job id                             Name               User          Time Use S Queue
------------------------- --------------------- ------------------- -------- - -----
1981.i136                       sub19327.sub      inca               00:00:00 C batch
20311.i136                      testjob           yourusername              <span class="m">0</span> R batch
</pre></div>
</div>
<dl class="last docutils">
<dt>Legend:</dt>
<dd><dl class="first last docutils">
<dt>Job id:</dt>
<dd>is the identifier assigned to your job.</dd>
<dt>Name:</dt>
<dd>is the name that you assigned to your job.</dd>
<dt>User:</dt>
<dd>is the username of the person who submitted the job.</dd>
<dt>Time:</dt>
<dd>is the amount of time the job has been running.</dd>
<dt>S:</dt>
<dd>shows the job state. Common job states are R for a running job, Q
for a job that is queued and waiting to run, C for a job that has
completed, and H for a job that is being held.</dd>
<dt>Queue:</dt>
<dd>is the name of the job queue where your job will run.</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p>If you are interested in only your job use grep:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ qstat <span class="p">|</span> grep 20311
</pre></div>
</div>
</div>
<div class="section" id="job-output">
<h3>Job Output<a class="headerlink" href="#job-output" title="Permalink to this headline">¶</a></h3>
<p>If you gave your job a name with the  <strong>#PBS -N &lt;jobname&gt;</strong> directive
in your job script or by specifying the job name on the command line,
your job output will be available in a file named  <strong>jobname.o######</strong>,
where the  <strong>######</strong> is the job number assigned by the job manager.
You can type  <strong>ls jobname.o*</strong> to see all output files from the same
job name.</p>
<p>If you explicitly name an output file with the  <strong>#PBS -o
&lt;outfile&gt;</strong> directive in your job script or by specifying the output
file on the command line, your output will be in the file you specified.
If you run the job again, the output file will be overwritten.</p>
<p>If you don&#8217;t specify any output file, your job output will have the same
name as your job script, and will be numbered in the same manner as if
you had specified a job name (<strong>jobname.o######</strong>).</p>
</div>
</div>
<div class="section" id="xray-hpc-services">
<h2>Xray HPC Services<a class="headerlink" href="#xray-hpc-services" title="Permalink to this headline">¶</a></h2>
<p>To log into the login node of xray please use the command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ssh portalname@xray.futuregrid.org
</pre></div>
</div>
<p>Extensive documentation about the user environment of the Cray can be
found at</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.cray.com/cgi-bin/craydoc.cgi?mode=View;id=S-2396-21">Cray XTTM Programming Environment User&#8217;s Guide</a></li>
</ul>
<p>For MPI jobs, use cc (pgcc). For best performance, add the xtpe-barcelona module:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>% module add xtpe-module
</pre></div>
</div>
<p>Currently there is only one queue (batch) available to users on the
Cray, and all jobs are automatically routed to that queue.  You can
use the same commands as introduced in the previous sections. Thus, to
list the queues please use:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>qstat -Q
</pre></div>
</div>
<p>To obtain details of running jobs and available processors, use the showq command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>/opt/moab/default/bin/showq
</pre></div>
</div>
<div class="section" id="submitting-a-job-on-xray">
<h3>Submitting a Job on xray<a class="headerlink" href="#submitting-a-job-on-xray" title="Permalink to this headline">¶</a></h3>
<p>To execute an MPI program on xray we use a special program called aprun in
the submit script. Additionally we have some special resource
specifications that we can pass along, such as mppwidth and
mppnppn. An example is the following program that will use 16
processors on 2 nodes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cat job.pbs
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#! /bin/sh</span>

<span class="c1">#PBS -l mppwidth=16</span>
<span class="c1">#PBS -l mppnppn=8</span>
<span class="c1">#PBS -N hpcc-16</span>
<span class="c1">#PBS -j oe</span>
<span class="c1">#PBS -l walltime=7:00:00</span>

<span class="c1">#cd to directory where job was submitted from</span>
<span class="nb">cd</span> <span class="nv">$PBS_O_WORKDIR</span>
<span class="nb">export</span> <span class="nv">MPICH_FAST_MEMCPY</span><span class="o">=</span>1
<span class="nb">export</span> <span class="nv">MPICH_PTL_MATCH_OFF</span><span class="o">=</span>1
aprun -n <span class="m">16</span> -N <span class="m">8</span> -ss -cc cpu hpcc

$ qsub job.pbs
</pre></div>
</div>
<p>The XT5m is a 2D mesh of nodes. Each node has two sockets, and each
socket has four cores. The batch scheduler interfaces with a Cray
resource scheduler called APLS. When you submit a job, the batch
scheduler talks to ALPS to find out what resources are available, and
ALPS then makes the reservation.</p>
<p>Currently ALPS is a &#8220;gang scheduler&#8221; and only allows one &#8220;job&#8221; per node.
If a user submits a job in the format aprun -n 1 a.out , ALPS will put
that job on one core of one node and leave the other seven cores empty.
When the next job comes in, either from the same user or a different
one, it will schedule that job to the next node.</p>
<p>If the user submits a job with aprun -n 10 a.out , then the scheduler
will put the first eight tasks on the first node and the next two tasks
on the second node, again leaving six empty cores on the second node.
The user can modify the placement with -N , -S , and -cc .</p>
<p>A user might also run a single job with multiple treads, as with OpenMPI.
If a user runs this job aprun -n 1 -d 8 a.out , the job will be
scheduled to one node and have eight threads running, one on each core.</p>
<p>You can run multiple, different binaries at the same time on the same
node, but only from one submission. Submitting a script like this
will not work:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">0</span> ./my-binary
<span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">1</span> ./my-binary
<span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">2</span> ./my-binary
<span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">3</span> ./my-binary
<span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">4</span> ./my-binary
<span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">5</span> ./my-binary
<span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">6</span> ./my-binary
<span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span> aprun -n <span class="m">1</span> -d <span class="m">1</span> -cc <span class="m">7</span> ./my-binary
</pre></div>
</div>
<p>This will run a job on each core, but not at the same time. To run all
jobs at the same time, you need to first add all the binaries within
one aprun command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cat run-all.pbs
./my-binary1
./my-binary2
./my-binary3
./my-binary4
./my-binary5
./my-binary6
./my-binary7
./my-binary8
$ aprun -n <span class="m">1</span> run.pbs
</pre></div>
</div>
<p>Alternatively, use the command aprun -n 1 -d 8 run.pbs. To run multiple
serial jobs, you must build a batch script to divide the number of jobs
into groups of eight, and the</p>
</div>
</div>
<div class="section" id="interactive-queues">
<h2>Interactive Queues<a class="headerlink" href="#interactive-queues" title="Permalink to this headline">¶</a></h2>
<p>The current queing system contains the ability to run interactive
queues. This is quite usefule, if you need to debug programs
interactively that you will run than in a bacth queue. To use this
feature we provide here a simple exaple on how to use a node on bravo.</p>
<p>Start an interactive shell with X11 forwarding on bravo you have to
first login into india as the bravo queues are currently controlled on
india:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ssh -X india
</pre></div>
</div>
<p>Than you need to start an interactive node:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>qsub -I -q bravo -X
</pre></div>
</div>
<p>As xterm is currently not installed on bravo, you can test the X11
forwarding with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>firefox
</pre></div>
</div>
<p>The best way is to find your own resources and let us know which we
shoudl add.</p>
</div>
</div>


			</div>
			
			
			
			<div id="navigation" class="large-3 pull-9 columns">
				<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i524/index.html">I524 Big Data &amp; Open Source Software Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i523/index.html">I523 Big Data Applications and Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Lessons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/index.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">Todos</a></li>
</ul>

			</div>
			
		</div>
		
		<div id="root_footer"></div>
	</div><div id="footer"><div id="bottom-nav"><span><a href="../../genindex.html"  title="General Index">index</a></span>
				</div><div id="footer-notice">
			    	&copy; Copyright 2016, 2017,
			    	Gregor von Laszewski, Badi Abdul-Wahid.
		        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.8.
	    </div></div><script>
		document.write('<script src=' +
		('__proto__' in {} ? '../../_static/foundation/js/vendor/zepto' : 'js/vendor/jquery') +
		'.js><\/script>')
	</script>
	<script src="../../_static/foundation/js/foundation.min.js"></script>
	<script src="../../_static/foundation/js/foundation/foundation.topbar.js"></script>
	<script>
		$(document).foundation();
		
		/**
		 * Fallback svg to png.
		 * Taken from Todd Motto's article:
		 * http://toddmotto.com/mastering-svg-use-for-a-retina-web-fallbacks-with-png-script/
		 */
		if(!Modernizr.svg) {
		    $('img[src*="svg"]').attr('src', function() {
		        return $(this).attr('src').replace('.svg', '.png');
		    });
		}
		
		// Reset width of all table columns.
		$('col').attr('width', null);
		
		// Add "returns" class to all returns elements
		$(".field-name:contains('Returns:')").parent().addClass('returns');
		
		
		
		
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'your-google-analytics-id']);
		_gaq.push(['_trackPageview']);
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
		
	</script>
	
		<a	id="github-ribbon"
			style="right: 0; border: 0;"
			href="https://github.com/cloudmesh/classes">
			<img
				 src="../../_static/forkme_right_gray_6d6d6d.png"
				 alt="Fork me on GitHub">
		</a>
	
</body>

</html>